<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Papierwerk Sundern Preisrechner</title>
<style>
body{font-family:Arial;background:#f5f8fb}
h1{color:#005a9c}
.box{background:#fff;padding:20px;border-radius:8px}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:8px;border-bottom:1px solid #ddd}
th{background:#005a9c;color:#fff}
.good{background:#dff0d8}
</style>
</head>
<body>
<h1>Papierwerk Sundern Preisrechner</h1>

<div class="box">
PLZ: <input id="plz" value="27777">
Paletten: <input id="pal" value="5">
Lademeter: <input id="lm" value="2">
<button onclick="calc()">Berechnen</button>
<div id="info"></div>
</div>

<table>
<thead><tr><th>Spediteur</th><th>Zone</th><th>Basis (€)</th><th>Preis (€)</th></tr></thead>
<tbody id="rows"></tbody>
</table>

<script>
let zones=[], rates=[], floater={};

async function load(){
  zones = await fetch("zones.csv").then(r=>r.text());
  rates = await fetch("rates.csv").then(r=>r.text());
  floater = await fetch("floater.json").then(r=>r.json());
  document.getElementById("info").innerText = "Daten geladen.";
}
load();

function parseCSV(t){return t.trim().split(/\r?\n/).map(r=>r.split(";"));}

function calc(){
  const plz = Number(document.getElementById("plz").value);
  const lm  = Number(document.getElementById("lm").value);
  const z = parseCSV(zones).slice(1);
  const r = parseCSV(rates).slice(1);
  const body = document.getElementById("rows");
  body.innerHTML = "";
  let cheapest = null;

  z.forEach(row=>{
    const f=row[0], from=Number(row[1]), to=Number(row[2]), zone=row[3];
    if(plz<from||plz>to) return;
    const rate = r.find(x=>x[0]===f && x[1]===zone);
    if(!rate) return;
    const base = Number(rate[2])*lm;
    const fl = floater[f]||0;
    const price = base*(1+fl/100);
    const tr=document.createElement("tr");
    tr.innerHTML = `<td>${f}</td><td>${zone}</td><td>${base.toFixed(2)}</td><td>${price.toFixed(2)}</td>`;
    body.appendChild(tr);
    if(cheapest===null||price<cheapest.price){
      cheapest={price,tr};
    }
  });
  if(cheapest) cheapest.tr.classList.add("good");
}
</script>
</body>
</html>